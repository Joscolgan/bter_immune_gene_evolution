#############################################################################################
#############################################################################################
## Author: Joe Colgan, Sarah Larragy			Program: fastp.sh
##
## Date: 28/06/22
##
#############################################################################################

## Filtering with FastP

##Make filtering directory and directories within:

mkdir filtering
mkdir input
mkdir results
mkdir src
mkdir data

## Install fastp into /src:
git clone https://github.com/OpenGene/fastp.git

## Link all raw genomes to input folder:

ln -s ../../data/X201SC19031072-Z01-F001/raw_data/MU_01/*.gz . #repeated for all samples

## In filtering directory create shell script to run fastp:

nano run_fastp.sh 			##Enter the following:

#!/bin/sh

#SBATCH --time=06:00:00
#SBATCH --nodes=1
#SBATCH -A mulif005c
#SBATCH -p ProdQ

for file in input/*1.fq.gz;
do
reverse="$(echo $file |cut -d '_' -f 1-5)";
output="$(echo $reverse |cut -d '/' -f 2)" ;
echo $output;
fastp -i $file \
-I "$reverse"_2.fq.gz \
-o results/"$output"_1.fq.gz \
-O results/"$output"_2.fq.gz \
--adapter_sequence AATGATACGGCGACCACCGAGATCTACACTCTTTCCCTACACGACGCTCTTCCGATCT \
--adapter_sequence_r2 GATCGGAAGAGCACACGTCTGAACTCCAGTCACATCACGATCTCGTATGCCGTCTTCTGCTTG \
--detect_adapter_for_pe \
-q 20 \
-u 40 \
--n_base_limit 15 \
-l 50 \
-p \
--thread 20;
done

## Submit script to slurm:

sbatch run_fastp.sh